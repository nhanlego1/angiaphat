<?php
/**
 * Created by PhpStorm.
 * User: nhan
 * Date: 10/17/16
 * Time: 11:37 PM
 */

/**
 * Checking ticket page
 * Implement hook_menu()
 */
function booking_menu() {
  $items = array();
  $items['ticket/checking'] = array(
    'access arguments' => array('access content'),
    'page callback' => 'booking_ticket_checking',
    'type' => MENU_CALLBACK
  );
  $items['admin/config/booking'] = array(
    'access arguments' => array('administrator'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array(
      'booking_setting_form'
    ),
    'file' => 'includes/booking.admin.inc',
    'type' => MENU_NORMAL_ITEM
  );
  return $items;
}

/**
 * Implementation of hook_theme().
 */
function booking_theme() {
  $items = array();
  $items['ticket_checking'] = array(
    'render element' => 'element',
    'path' => drupal_get_path('module', 'booking') . '/theme',
    'template' => 'ticket-checking',
  );
  return $items;
}

/**
 * Implement booking_ticket_checking
 */
function booking_ticket_checking() {
  $data = _build_data_booking();
  return theme('ticket_checking', $data);
}

/**
 * Implementation of hook_block_info().
 */
function booking_block_info() {
  $blocks = array();
  $blocks['ticket_form'] = array('info' => t('Ticket Form'));
  return $blocks;
}

/**
 * Implementation of hook_block_view().
 */
function booking_block_view($delta = '') {
  switch ($delta) {
    case 'ticket_form':
      $data = _build_data_booking();
      return array(
        'subject' => t('Ticket Form'),
        'content' => theme('ticket_checking', $data),
      );
      break;

  }
}

/**
 * Build booking data
 */
function _build_data_booking() {
  $data = array();
  $data['booking_data'] = array();
  if (isset($_POST['booking_action']) && !empty($_POST['booking_action'])) {
    $data['booking_data'] = $_POST['booking'];
  }

  $data['booking_data']['max_people'] = array(
    'adult' => variable_get('max_people_adult', 10),
    'child_medium' => variable_get('max_people_child_medium', 10),
    'child' => variable_get('max_people_child', 10),
  );

  return $data;
}

